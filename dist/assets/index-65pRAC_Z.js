import{r as d,j as e,B as y,i as p}from"./index-CkkKPyuP.js";import{u as I,i as O,T as S,a as g,C as z,b as H,c as M,e as B,f as b,g as R,j as U,P as V,k as $}from"./pagination-CzlqMKQ0.js";import{E as q,A as G,a as J,b as K,c as Q,d as W,e as X,f as Y,g as Z}from"./alert-dialog-CdkxFdne.js";import{g as ee,h as se,i as ae,j as T}from"./index-C-92eTuZ.js";import{a as C,t as w,L as m,I as u,z as l}from"./index-D2dM0BLR.js";import{D as _,a as A,b as F,c as E}from"./dialog-BlqGUlRA.js";import{I as te}from"./icons-Fc6yfTK3.js";import"./index-BpDdPLnr.js";const ne=l.object({name:l.string().min(1),description:l.string().min(1),days_count:l.coerce.number().int().positive(),price:l.coerce.number().nonnegative(),filters_count:l.coerce.number().int().nonnegative()});function ie({open:s,onOpenChange:t,tariff:n,onUpdated:c}){const{register:a,handleSubmit:x,formState:{errors:r}}=C({resolver:w(ne),defaultValues:{name:n.name,description:n.description,days_count:n.days_count,price:n.price,filters_count:n.filters_count}}),[i,o]=d.useState(!1),N=async f=>{o(!0);try{const v=await I(n.id,f);c(v),p.success("Tariff updated"),t(!1)}catch{p.error("Failed to update tariff")}finally{o(!1)}};return e.jsx(_,{open:s,onOpenChange:t,children:e.jsxs(A,{children:[e.jsx(F,{children:e.jsx(E,{children:"Edit Tariff"})}),e.jsxs("form",{onSubmit:x(N),className:"space-y-4 pt-2",autoComplete:"off",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(m,{children:"Name"}),e.jsx(u,{...a("name")}),r.name&&e.jsx("p",{className:"text-xs text-red-600",children:r.name.message})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(m,{children:"Description"}),e.jsx(u,{...a("description")}),r.description&&e.jsx("p",{className:"text-xs text-red-600",children:r.description.message})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(m,{children:"Days"}),e.jsx(u,{type:"number",...a("days_count")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(m,{children:"Price"}),e.jsx(u,{type:"number",...a("price")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(m,{children:"Filters"}),e.jsx(u,{type:"number",...a("filters_count")})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:i,children:"Cancel"}),e.jsx(y,{type:"submit",disabled:i,children:i?"Saving…":"Save"})]})]})]})})}function re({tariff:s,onDeleted:t,onUpdated:n}){const[c,a]=d.useState(!1),[x,r]=d.useState(!1),[i,o]=d.useState(!1),N=async()=>{o(!0);try{await O(s.id),t(s.id),p.success("Tariff deleted"),a(!1)}catch{p.error("Failed to delete tariff")}finally{o(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"icon",className:"h-8 w-8 p-0",children:e.jsx(q,{className:"h-4 w-4"})})}),e.jsxs(ae,{align:"end",className:"w-32",children:[e.jsx(T,{onSelect:()=>r(!0),children:"Edit"}),e.jsx(T,{className:"text-red-600 focus:text-red-600",onSelect:f=>{f.preventDefault(),a(!0)},children:"Delete"})]})]}),e.jsx(ie,{open:x,onOpenChange:r,tariff:s,onUpdated:n}),e.jsx(G,{open:c,onOpenChange:a,children:e.jsxs(J,{children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Delete tariff?"}),e.jsx(W,{children:"This action cannot be undone."})]}),e.jsxs(X,{children:[e.jsx(Y,{disabled:i,children:"Cancel"}),e.jsx(Z,{disabled:i,onClick:N,className:"bg-red-600 hover:bg-red-700",children:i?"Deleting…":"Delete"})]})]})})]})}function ce({tariff:s,onDelete:t,onUpdate:n}){return e.jsxs(S,{className:"transition-colors hover:bg-muted/50",children:[e.jsx(g,{children:s.name}),e.jsx(g,{children:s.description}),e.jsx(g,{className:"text-right",children:s.days_count}),e.jsx(g,{className:"text-right",children:s.price}),e.jsx(g,{className:"text-right",children:s.filters_count}),e.jsx(g,{className:"text-right",children:e.jsx(re,{tariff:s,onDeleted:t,onUpdated:n})})]})}function le({tariffs:s,onDelete:t,onUpdate:n}){return e.jsx(z,{className:"rounded-2xl border border-muted bg-background shadow-lg",children:e.jsx(H,{className:"overflow-x-auto p-0",children:e.jsxs(M,{className:"min-w-full text-sm",children:[e.jsx(B,{children:e.jsxs(S,{className:"text-xs uppercase text-muted-foreground",children:[e.jsx(b,{className:"w-40",children:"Name"}),e.jsx(b,{children:"Description"}),e.jsx(b,{className:"w-24 text-right",children:"Days"}),e.jsx(b,{className:"w-24 text-right",children:"Price"}),e.jsx(b,{className:"w-24 text-right",children:"Filters"}),e.jsx(b,{className:"w-12 text-right"})]})}),e.jsx(R,{children:s.map(c=>e.jsx(ce,{tariff:c,onDelete:t,onUpdate:n},c.id))})]})})})}const de=l.object({name:l.string().min(1),description:l.string().min(1),days_count:l.coerce.number().int().positive(),price:l.coerce.number().nonnegative(),filters_count:l.coerce.number().int().nonnegative()});function oe({defaultValues:s,loading:t,onSubmit:n,onCancel:c}){const{register:a,handleSubmit:x,formState:{errors:r}}=C({resolver:w(de),defaultValues:s});return e.jsxs("form",{onSubmit:x(n),className:"space-y-4",children:[["name","description"].map(i=>{var o;return e.jsxs("div",{className:"space-y-1",children:[e.jsx(m,{className:"capitalize",children:i}),e.jsx(u,{...a(i)}),r[i]&&e.jsx("p",{className:"text-xs text-red-600",children:(o=r[i])==null?void 0:o.message})]},i)}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Days"}),e.jsx(u,{type:"number",...a("days_count")})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Price"}),e.jsx(u,{type:"number",...a("price")})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Filters"}),e.jsx(u,{type:"number",...a("filters_count")})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(y,{type:"button",variant:"outline",onClick:c,disabled:t,children:"Cancel"}),e.jsx(y,{type:"submit",disabled:t,children:t?"Saving…":"Save"})]})]})}function xe({open:s,onOpenChange:t,onCreated:n}){const[c,a]=d.useState(!1),x=async r=>{a(!0);try{const i=await U(r);n(i),p.success("Tariff created"),t(!1)}catch{p.error("Failed to create tariff")}finally{a(!1)}};return e.jsx(_,{open:s,onOpenChange:t,children:e.jsxs(A,{children:[e.jsx(F,{children:e.jsx(E,{children:"New Tariff"})}),e.jsx(oe,{defaultValues:{name:"",description:"",days_count:0,price:0,filters_count:0},loading:c,onSubmit:x,onCancel:()=>t(!1)})]})})}function ye(){const[s,t]=d.useState(1),n=50,[c,a]=d.useState([]),[x,r]=d.useState(!1),[i,o]=d.useState(1),[N,f]=d.useState(!0),v=async(h=s)=>{f(!0);try{const j=await $(h,n);a(j.items),o(j.pages)}catch{p.error("Cannot load tariffs")}finally{f(!1)}};d.useEffect(()=>{v(s)},[s]);const P=h=>a(j=>j.filter(D=>D.id!==h)),L=h=>a(j=>j.map(D=>D.id===h.id?h:D)),k=h=>a(j=>[h,...j]);return e.jsxs("main",{className:"container mx-auto space-y-6 p-6",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(y,{onClick:()=>r(!0),children:[e.jsx(te.add,{className:"mr-2 h-4 w-4"}),"Add Tariff"]})}),N?e.jsx("p",{className:"text-center",children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsx(le,{tariffs:c,onDelete:P,onUpdate:L}),e.jsx(V,{current:s,total:i,size:n,onChange:t})]}),e.jsx(xe,{open:x,onOpenChange:r,onCreated:k})]})}export{ye as default};
